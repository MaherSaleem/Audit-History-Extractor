using System;
using System.Collections.Generic;
using System.ComponentModel.Composition;
using System.IO;
using System.Linq;
using System.Reflection;
using System.Text;
using System.Threading.Tasks;
using XrmToolBox.Extensibility;
using XrmToolBox.Extensibility.Interfaces;

namespace AuditHistoryExtractor
{
    [Export(typeof(IXrmToolBoxPlugin)),
    ExportMetadata("BackgroundColor", "#26577F"),
    ExportMetadata("PrimaryFontColor", "White"),
    ExportMetadata("SecondaryFontColor", "Gray"),
    ExportMetadata("SmallImageBase64", "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"),
    ExportMetadata("BigImageBase64", "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"),
    ExportMetadata("Name", "Audit History Extractor"),
    ExportMetadata("Description", "Audit History Extractor")]
    public class MyPlugin : PluginBase
    {
        public override IXrmToolBoxPluginControl GetControl()
        {
            return new MyPluginControl();
        }


        static void Main()
        {
            AppDomain.CurrentDomain.AssemblyResolve += (sender, bargs) =>
            {
                String dllName = new AssemblyName(bargs.Name).Name + ".dll";
                var assem = Assembly.GetExecutingAssembly();
                String resourceName = assem.GetManifestResourceNames().FirstOrDefault(rn => rn.EndsWith(dllName));
                if (resourceName == null) return null; // Not found, maybe another handler will find it
                using (var stream = assem.GetManifestResourceStream(resourceName))
                {
                    Byte[] assemblyData = new Byte[stream.Length];
                    stream.Read(assemblyData, 0, assemblyData.Length);
                    return Assembly.Load(assemblyData);
                }
            };
        }
    }
}
